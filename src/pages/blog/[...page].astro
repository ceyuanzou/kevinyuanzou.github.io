---
import type { Post, Page } from "@interfaces/data";
import PostCard from "@components/PostCard.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import Pagination from "@components/widgets/Pagination.astro";
import CardGroup from "@components/temple/CardGroup.astro";
import { Icon } from "astro-icon/components";
import { t } from "@config";
import { generatePageLinks } from "@utils/blogUtils";
import { getMainBlogPaginationPaths } from "@utils/paginationUtils";

// 确保 getStaticPaths 正确返回分页信息
export async function getStaticPaths({ paginate }: { paginate: any }) {
  return getMainBlogPaginationPaths({ paginate });
}

// 解构 props，并做好类型标注
const { page }: { page: Page } = Astro.props;

// 健壮性处理，防止 page 或 page.data 未定义时报错
const posts = Array.isArray(page?.data) ? page.data : [];

// 计算总页数并生成分页链接
const totalPages = Math.ceil(page?.total ? page.total / page.size : 1);
const pageLinks = generatePageLinks(totalPages);
---

<BaseLayout title="Blog">
  <!-- Blog Navigation Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- 省略导航卡片，和你的源代码一致 -->
    <!-- ... -->
  </div>

  <!-- Blog Post List -->
  <CardGroup cols="1" gap="6">
    {
      posts.length > 0
        ? posts.map((blog: Post) => (
            <PostCard
              title={blog.data.title}
              image={blog.data.image}
              description={blog.data.description}
              url={"/blog/" + blog.slug}
              pubDate={blog.data.pubDate}
              badge={blog.data.badge}
              categories={blog.data.categories}
              tags={blog.data.tags}
              word={blog.remarkPluginFrontmatter.totalCharCount}
              time={blog.remarkPluginFrontmatter.readingTime}
            />
          ))
        : <p>No posts found.</p>
    }
  </CardGroup>

  <Pagination page={page} totalPages={totalPages} pageLinks={pageLinks} baseUrl={`/blog`} />
</BaseLayout>