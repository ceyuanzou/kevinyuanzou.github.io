---
import type { Post } from "@interfaces/data";
import PostCard from "@components/PostCard.astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import BaseCard from "@components/BaseCard.astro";
import CardGroup from "@components/temple/CardGroup.astro";
import { t } from "@config";
import { Icon } from "astro-icon/components";

import { getAllPosts } from "@utils/blogUtils";

// 获取所有博文
const allBlogsRaw = await getAllPosts();

const tag = "Research";
// 只筛选带有 Research 标签的博客
const blogs: Post[] = allBlogsRaw.filter(
  blog => blog.data.tags && blog.data.tags.includes(tag)
);

// 计算字数和阅读时间辅助函数
function getReadingTime(text: string): string {
  const words = text.trim().split(/\s+/).length;
  const minutes = Math.max(1, Math.round(words / 200));
  return `${minutes} min`;
}

function getCharCount(text: string): number {
  return text.replace(/\s/g, '').length;
}
---

<BaseLayout title="Research">
  <BaseCard>
    <div class="space-y-6">
      <section class="py-4">
        <div class="flex flex-col items-center text-center">
          <h1
            class="text-4xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent leading-loose"
          >
            Hello! Welcome to Kevin ZOU's Research!
          </h1>
          <p class="text-xl text-base-content/80 max-w-3xl">
            Here, I will share my research work!
          </p>
        </div>
      </section>
    </div>
  </BaseCard>

  <CardGroup cols="1" gap="6">
    {
      blogs.map((blog) => (
        <PostCard
          title={blog.data.title}
          image={blog.data.image}
          description={blog.data.description}
          url={"/blog/" + blog.slug}
          pubDate={blog.data.pubDate}
          badge={blog.data.badge}
          categories={blog.data.categories}
          tags={blog.data.tags}
          word={getCharCount(blog.body)}         // 字符数
          time={getReadingTime(blog.body)}       // 阅读时长
        />
      ))
    }
  </CardGroup>
</BaseLayout>